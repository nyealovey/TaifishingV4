é”™è¯¯: error: cannot format /Users/shiyijiufei/TaifishingV4/app/routes/account_sync.py: Cannot parse for target version Python 3.13: 266:0:                         sync_record = SyncData(  # type: ignore  # type: ignore
would reformat /Users/shiyijiufei/TaifishingV4/app/utils/enhanced_logger.py
would reformat /Users/shiyijiufei/TaifishingV4/app/routes/instances.py

Oh no! ğŸ’¥ ğŸ’” ğŸ’¥
2 files would be reformatted, 68 files would be left unchanged, 1 file would fail to reformat.


æ ‡å‡†è¾“å‡º:
--- /Users/shiyijiufei/TaifishingV4/app/utils/enhanced_logger.py	2025-09-12 23:33:24.808404+00:00
+++ /Users/shiyijiufei/TaifishingV4/app/utils/enhanced_logger.py	2025-09-12 23:45:59.911448+00:00
@@ -5,11 +5,11 @@
 
 import logging
 import traceback
 from typing import Any, Optional, Callable, TypeVar, Dict
 
-F = TypeVar('F', bound=Callable[..., Any])
+F = TypeVar("F", bound=Callable[..., Any])
 
 from flask import current_app, has_request_context, request
 from flask_login import current_user
 
 # å»¶è¿Ÿå¯¼å…¥ä»¥é¿å…å¾ªç¯å¯¼å…¥
@@ -89,67 +89,112 @@
         except Exception as e:
             # å¦‚æœæ•°æ®åº“è®°å½•å¤±è´¥ï¼Œè‡³å°‘è®°å½•åˆ°æ–‡ä»¶
             self.logger.error(f"è®°å½•æ—¥å¿—åˆ°æ•°æ®åº“å¤±è´¥: {e}")
 
     def debug(
-        self, message: str, module: Optional[str] = None, details: Optional[str] = None, exception: Optional[Exception] = None, source: Optional[str] = None
+        self,
+        message: str,
+        module: Optional[str] = None,
+        details: Optional[str] = None,
+        exception: Optional[Exception] = None,
+        source: Optional[str] = None,
     ) -> None:
         """è®°å½•DEBUGçº§åˆ«æ—¥å¿—"""
         self.logger.debug(message)
         self._log_to_database("DEBUG", "system", message, module, details, exception, source)
 
     def info(
-        self, message: str, module: Optional[str] = None, details: Optional[str] = None, exception: Optional[Exception] = None, source: Optional[str] = None
+        self,
+        message: str,
+        module: Optional[str] = None,
+        details: Optional[str] = None,
+        exception: Optional[Exception] = None,
+        source: Optional[str] = None,
     ) -> None:
         """è®°å½•INFOçº§åˆ«æ—¥å¿—"""
         self.logger.info(message)
         self._log_to_database("INFO", "operation", message, module, details, exception, source)
 
     def warning(
-        self, message: str, module: Optional[str] = None, details: Optional[str] = None, exception: Optional[Exception] = None, source: Optional[str] = None
+        self,
+        message: str,
+        module: Optional[str] = None,
+        details: Optional[str] = None,
+        exception: Optional[Exception] = None,
+        source: Optional[str] = None,
     ) -> None:
         """è®°å½•WARNINGçº§åˆ«æ—¥å¿—"""
         self.logger.warning(message)
         self._log_to_database("WARNING", "operation", message, module, details, exception, source)
 
     def error(
-        self, message: str, module: Optional[str] = None, details: Optional[str] = None, exception: Optional[Exception] = None, source: Optional[str] = None
+        self,
+        message: str,
+        module: Optional[str] = None,
+        details: Optional[str] = None,
+        exception: Optional[Exception] = None,
+        source: Optional[str] = None,
     ) -> None:
         """è®°å½•ERRORçº§åˆ«æ—¥å¿—"""
         self.logger.error(message)
         self._log_to_database("ERROR", "error", message, module, details, exception, source)
 
     def critical(
-        self, message: str, module: Optional[str] = None, details: Optional[str] = None, exception: Optional[Exception] = None, source: Optional[str] = None
+        self,
+        message: str,
+        module: Optional[str] = None,
+        details: Optional[str] = None,
+        exception: Optional[Exception] = None,
+        source: Optional[str] = None,
     ) -> None:
         """è®°å½•CRITICALçº§åˆ«æ—¥å¿—"""
         self.logger.critical(message)
         self._log_to_database("CRITICAL", "error", message, module, details, exception, source)
 
     def security(
-        self, message: str, module: Optional[str] = None, details: Optional[str] = None, exception: Optional[Exception] = None, source: Optional[str] = None
+        self,
+        message: str,
+        module: Optional[str] = None,
+        details: Optional[str] = None,
+        exception: Optional[Exception] = None,
+        source: Optional[str] = None,
     ) -> None:
         """è®°å½•å®‰å…¨ç›¸å…³æ—¥å¿—"""
         self.logger.warning(f"SECURITY: {message}")
         self._log_to_database("WARNING", "security", message, module, details, exception, source)
 
     def database(
-        self, message: str, module: Optional[str] = None, details: Optional[str] = None, exception: Optional[Exception] = None, source: Optional[str] = None
+        self,
+        message: str,
+        module: Optional[str] = None,
+        details: Optional[str] = None,
+        exception: Optional[Exception] = None,
+        source: Optional[str] = None,
     ) -> None:
         """è®°å½•æ•°æ®åº“ç›¸å…³æ—¥å¿—"""
         self.logger.error(f"DATABASE: {message}")
         self._log_to_database("ERROR", "database", message, module, details, exception, source)
 
     def sync(
-        self, message: str, module: Optional[str] = None, details: Optional[str] = None, exception: Optional[Exception] = None, source: Optional[str] = None
+        self,
+        message: str,
+        module: Optional[str] = None,
+        details: Optional[str] = None,
+        exception: Optional[Exception] = None,
+        source: Optional[str] = None,
     ) -> None:
         """è®°å½•åŒæ­¥ç›¸å…³æ—¥å¿—"""
         self.logger.info(f"SYNC: {message}")
         self._log_to_database("INFO", "sync", message, module, details, exception, source)
 
     def api(
-        self, message: str, module: Optional[str] = None, details: Optional[str] = None, exception: Optional[Exception] = None, source: Optional[str] = None
+        self,
+        message: str,
+        module: Optional[str] = None,
+        details: Optional[str] = None,
+        exception: Optional[Exception] = None,
+        source: Optional[str] = None,
     ) -> None:
         """è®°å½•APIç›¸å…³æ—¥å¿—"""
         self.logger.info(f"API: {message}")
         self._log_to_database("INFO", "api", message, module, details, exception, source)
 
@@ -164,11 +209,13 @@
 api_logger = EnhancedLogger("taifish.api")
 security_logger = EnhancedLogger("taifish.security")
 system_logger = EnhancedLogger("taifish.system")
 
 
-def log_exception(exception: Exception, message: Optional[str] = None, module: Optional[str] = None, level: str = "ERROR") -> None:
+def log_exception(
+    exception: Exception, message: Optional[str] = None, module: Optional[str] = None, level: str = "ERROR"
+) -> None:
     """è®°å½•å¼‚å¸¸çš„ä¾¿æ·å‡½æ•°"""
     if message is None:
         message = f"æœªå¤„ç†çš„å¼‚å¸¸: {type(exception).__name__}"
 
     if level == "CRITICAL":
@@ -177,17 +224,21 @@
         enhanced_logger.warning(message, module, exception=exception)
     else:
         enhanced_logger.error(message, module, exception=exception)
 
 
-def log_database_error(operation: str, error: Exception, module: Optional[str] = None, details: Optional[str] = None) -> None:
+def log_database_error(
+    operation: str, error: Exception, module: Optional[str] = None, details: Optional[str] = None
+) -> None:
     """è®°å½•æ•°æ®åº“é”™è¯¯çš„ä¾¿æ·å‡½æ•°"""
     message = f"æ•°æ®åº“æ“ä½œå¤±è´¥: {operation}"
     db_logger.database(message, module, details, error)
 
 
-def log_sync_error(operation: str, error: Exception, module: Optional[str] = None, details: Optional[str] = None) -> None:
+def log_sync_error(
+    operation: str, error: Exception, module: Optional[str] = None, details: Optional[str] = None
+) -> None:
     """è®°å½•åŒæ­¥é”™è¯¯çš„ä¾¿æ·å‡½æ•°"""
     message = f"åŒæ­¥æ“ä½œå¤±è´¥: {operation}"
     sync_logger.error(message, module, details, error)
 
 
@@ -195,11 +246,13 @@
     """è®°å½•APIé”™è¯¯çš„ä¾¿æ·å‡½æ•°"""
     message = f"APIè°ƒç”¨å¤±è´¥: {endpoint}"
     api_logger.error(message, module, details, error)
 
 
-def log_security_event(event: str, details: Optional[str] = None, module: Optional[str] = None, level: str = "WARNING") -> None:
+def log_security_event(
+    event: str, details: Optional[str] = None, module: Optional[str] = None, level: str = "WARNING"
+) -> None:
     """è®°å½•å®‰å…¨äº‹ä»¶çš„ä¾¿æ·å‡½æ•°"""
     if level == "ERROR":
         security_logger.error(f"å®‰å…¨äº‹ä»¶: {event}", module, details)
     else:
         security_logger.security(f"å®‰å…¨äº‹ä»¶: {event}", module, details)
@@ -313,11 +366,18 @@
 
     logger.error(f"é”™è¯¯æ—¥å¿—: {error_data}")
 
 
 # APIè¯·æ±‚æ—¥å¿—å‡½æ•°
-def log_api_request(method: str, endpoint: str, status_code: int, duration: float, user_id: Optional[int] = None, ip_address: Optional[str] = None) -> None:
+def log_api_request(
+    method: str,
+    endpoint: str,
+    status_code: int,
+    duration: float,
+    user_id: Optional[int] = None,
+    ip_address: Optional[str] = None,
+) -> None:
     """
     è®°å½•APIè¯·æ±‚æ—¥å¿—
 
     Args:
         method: HTTPæ–¹æ³•
--- /Users/shiyijiufei/TaifishingV4/app/routes/instances.py	2025-09-12 23:40:53.304581+00:00
+++ /Users/shiyijiufei/TaifishingV4/app/routes/instances.py	2025-09-12 23:46:00.009025+00:00
@@ -98,11 +98,11 @@
 @create_required
 def create() -> Union[str, Response, Tuple[Response, int]]:
     """åˆ›å»ºå®ä¾‹"""
     # è·å–å‡­æ®åˆ—è¡¨
     credentials = Credential.query.filter_by(is_active=True).all()
-    
+
     if request.method == "POST":
         data = request.get_json() if request.is_json else request.form
 
         # æ¸…ç†è¾“å…¥æ•°æ®
         data = sanitize_form_data(data)
@@ -762,11 +762,13 @@
 
     except Exception as e:
         return jsonify({"success": False, "error": f"CSVæ–‡ä»¶å¤„ç†å¤±è´¥: {str(e)}"}), 400
 
 
-def _process_instances_data(instances_data: List[Dict[str, Any]]) -> Union[Dict[str, Any], Response, Tuple[Response, int]]:
+def _process_instances_data(
+    instances_data: List[Dict[str, Any]],
+) -> Union[Dict[str, Any], Response, Tuple[Response, int]]:
     """å¤„ç†å®ä¾‹æ•°æ®"""
     created_count = 0
     errors = []
 
     for i, instance_data in enumerate(instances_data):
