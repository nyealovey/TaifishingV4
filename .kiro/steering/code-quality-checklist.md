---
inclusion: always
---

## CODE_QUALITY

### Guidelines for QUALITY_ASSURANCE

#### PRE_COMMIT_CHECKS

- **代码格式化**: 运行Black确保代码格式一致
- **导入排序**: 运行isort确保导入语句正确排序
- **类型检查**: 运行MyPy检查类型注解
- **Linting**: 运行Ruff检查代码质量问题
- **安全扫描**: 运行Bandit检查安全漏洞
- **测试覆盖**: 确保测试覆盖率达标

#### SECURITY_CHECKS

- **SQL注入**: 检查所有数据库查询使用参数化查询
- **硬编码密码**: 扫描代码中的硬编码密码和密钥
- **输入验证**: 确保所有用户输入都经过验证
- **CSRF保护**: 检查所有POST/PUT/DELETE请求有CSRF令牌
- **XSS防护**: 确保输出内容正确转义
- **文件上传**: 验证文件类型和大小限制

#### CODE_STYLE_CHECKS

- **命名规范**: 变量使用snake_case，类使用PascalCase
- **函数长度**: 单个函数不超过50行
- **类长度**: 单个类不超过500行
- **复杂度**: 避免过深的嵌套，最多3层
- **注释**: 所有公共函数必须有docstring
- **类型提示**: 所有函数参数和返回值有类型注解

#### ERROR_HANDLING_CHECKS

- **异常类型**: 避免使用裸露的except语句
- **错误记录**: 确保所有异常都被正确记录
- **资源清理**: 确保异常时正确清理资源
- **重试机制**: 对可恢复错误实现重试
- **优雅降级**: 非关键功能失败时应用继续运行

#### PERFORMANCE_CHECKS

- **数据库查询**: 检查N+1查询问题
- **缓存使用**: 合理使用缓存减少重复计算
- **内存使用**: 避免内存泄漏和过度使用
- **并发安全**: 确保多线程环境下的数据一致性
- **资源限制**: 设置合理的超时和限制

#### TESTING_CHECKS

- **单元测试**: 核心功能有单元测试覆盖
- **集成测试**: 关键流程有集成测试
- **测试覆盖率**: 代码覆盖率不低于80%
- **测试数据**: 使用fixture管理测试数据
- **错误测试**: 测试异常情况的处理

#### DOCUMENTATION_CHECKS

- **API文档**: 所有API接口有文档说明
- **代码注释**: 复杂逻辑有详细注释
- **README**: 项目有完整的README文档
- **变更日志**: 记录重要的代码变更
- **部署文档**: 有详细的部署和配置说明

#### DEPENDENCY_CHECKS

- **版本固定**: 依赖版本固定，避免兼容性问题
- **安全更新**: 定期更新依赖包修复安全漏洞
- **依赖分析**: 检查不必要的依赖
- **许可证**: 确保依赖包许可证兼容
- **大小优化**: 避免引入过大的依赖包

#### CONFIGURATION_CHECKS

- **环境变量**: 敏感配置使用环境变量
- **默认值**: 提供合理的默认配置
- **验证**: 启动时验证配置参数
- **文档**: 配置参数有详细说明
- **示例**: 提供配置示例文件

#### MONITORING_CHECKS

- **日志记录**: 关键操作有日志记录
- **指标收集**: 收集性能和使用指标
- **告警配置**: 设置适当的告警阈值
- **健康检查**: 实现应用健康检查接口
- **错误追踪**: 实现错误追踪和报告

#### DEPLOYMENT_CHECKS

- **环境隔离**: 开发、测试、生产环境隔离
- **配置管理**: 不同环境使用不同配置
- **回滚机制**: 实现快速回滚机制
- **备份策略**: 重要数据有备份策略
- **监控部署**: 部署过程有监控和日志

#### MAINTENANCE_CHECKS

- **代码清理**: 定期清理无用代码和注释
- **重构**: 及时重构复杂和重复代码
- **技术债务**: 跟踪和解决技术债务
- **性能优化**: 定期进行性能优化
- **安全审计**: 定期进行安全审计

#### CODE_REVIEW_CHECKS

- **功能正确性**: 代码实现符合需求
- **性能影响**: 评估对系统性能的影响
- **安全风险**: 识别潜在的安全风险
- **可维护性**: 代码易于理解和维护
- **测试充分性**: 测试用例覆盖充分

#### CONTINUOUS_IMPROVEMENT

- **质量指标**: 跟踪代码质量指标趋势
- **最佳实践**: 学习和应用行业最佳实践
- **工具更新**: 定期更新开发工具和检查规则
- **团队培训**: 定期进行代码质量培训
- **经验总结**: 总结和分享质量改进经验
