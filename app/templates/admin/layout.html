{% extends "base.html" %}

{% block title %}{{ title or "管理中心" }} - 泰摸鱼吧{% endblock %}

{% block extra_css %}
<style>
    /* 管理页面专用样式 - 使用!important确保优先级 */
    body.admin-page {
        padding-top: 0 !important;
        margin: 0 !important;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
    }
    
    .navbar.admin-navbar {
        margin-left: 280px !important;
        z-index: 1001 !important;
        position: relative !important;
    }
    
    /* 管理菜单样式 */
    .admin-menu {
        position: fixed !important;
        left: 0 !important;
        top: 0 !important;
        width: 280px !important;
        height: 100vh !important;
        background: #f8f9fa !important;
        border-right: 1px solid #dee2e6 !important;
        z-index: 1000 !important;
        overflow-y: auto !important;
        box-shadow: 2px 0 4px rgba(0,0,0,0.1) !important;
    }
    
    .admin-menu .card {
        border: none !important;
        border-radius: 0 !important;
        height: 100vh !important;
        margin: 0 !important;
    }
    
    .admin-menu .nav-link {
        color: #495057 !important;
        padding: 0.75rem 1rem !important;
        border-radius: 0 !important;
        border-left: 3px solid transparent !important;
        transition: all 0.3s ease !important;
        text-decoration: none !important;
    }
    
    .admin-menu .nav-link:hover {
        background-color: #e9ecef !important;
        border-left-color: #007bff !important;
        color: #007bff !important;
    }
    
    .admin-menu .nav-link.active {
        background-color: #007bff !important;
        color: white !important;
        border-left-color: #0056b3 !important;
    }
    
    .admin-menu .dropdown-menu {
        border: none !important;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075) !important;
        border-radius: 0.375rem !important;
        margin-left: 1rem !important;
    }
    
    .admin-menu .dropdown-item {
        padding: 0.5rem 1rem !important;
        color: #495057 !important;
        transition: all 0.3s ease !important;
        text-decoration: none !important;
    }
    
    .admin-menu .dropdown-item:hover {
        background-color: #f8f9fa !important;
        color: #007bff !important;
    }
    
    .admin-menu .dropdown-item i {
        width: 16px !important;
        text-align: center !important;
    }
    
    /* 主内容区域 */
    .admin-content {
        margin-left: 280px !important;
        padding: 20px !important;
        min-height: 100vh !important;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    }
    
    /* 响应式设计 */
    @media (max-width: 768px) {
        .navbar.admin-navbar {
            margin-left: 0 !important;
        }
        
        .admin-menu {
            width: 100% !important;
            height: auto !important;
            position: relative !important;
        }
        
        .admin-menu .card {
            height: auto !important;
        }
        
        .admin-content {
            margin-left: 0 !important;
            padding: 10px !important;
        }
    }
</style>
{% endblock %}

{% block content %}
<script>
// 添加管理页面类名
document.body.classList.add('admin-page');
</script>

<!-- 管理菜单 -->
<div class="admin-menu">
    {% include 'admin/menu.html' %}
</div>

<!-- 主内容区域 -->
<div class="admin-content">
    <!-- 页面标题 -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-0">{{ title or "管理中心" }}</h1>
            {% if subtitle %}
            <p class="text-muted mb-0">{{ subtitle }}</p>
            {% endif %}
        </div>
        <div>
            {% if show_refresh %}
            <button class="btn btn-outline-primary btn-sm" onclick="refreshPage()">
                <i class="fas fa-sync-alt me-1"></i>刷新
            </button>
            {% endif %}
            {% if show_back %}
            <button class="btn btn-outline-secondary btn-sm" onclick="history.back()">
                <i class="fas fa-arrow-left me-1"></i>返回
            </button>
            {% endif %}
        </div>
    </div>
    
    <!-- 页面内容 -->
    {% block admin_content %}
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">欢迎使用管理中心</h5>
                    <p class="card-text">请选择左侧菜单中的功能进行操作。</p>
                </div>
            </div>
        </div>
    </div>
    {% endblock %}
</div>
{% endblock %}

{% block extra_js %}
<script>
function refreshPage() {
    location.reload();
}

// 管理页面通用功能
document.addEventListener('DOMContentLoaded', function() {
    // 自动刷新数据（如果页面需要）
    if (typeof autoRefreshInterval !== 'undefined' && autoRefreshInterval > 0) {
        setInterval(function() {
            if (typeof refreshData === 'function') {
                refreshData();
            }
        }, autoRefreshInterval);
    }
    
    // 显示加载状态
    const loadingOverlay = document.getElementById('loading-overlay');
    if (loadingOverlay) {
        setTimeout(() => {
            loadingOverlay.style.display = 'none';
        }, 1000);
    }
});

// 通用错误处理
function handleError(error, message = '操作失败') {
    console.error('Error:', error);
    alert(message + ': ' + (error.message || error));
}

// 通用成功处理
function handleSuccess(message = '操作成功') {
    alert(message);
}

// 确认对话框
function confirmAction(message, callback) {
    if (confirm(message)) {
        callback();
    }
}

// 显示通知
function showNotification(message, type = 'info') {
    const alertClass = {
        'success': 'alert-success',
        'error': 'alert-danger',
        'warning': 'alert-warning',
        'info': 'alert-info'
    }[type] || 'alert-info';
    
    const notification = document.createElement('div');
    notification.className = `alert ${alertClass} alert-dismissible fade show position-fixed`;
    notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(notification);
    
    // 自动消失
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 5000);
}
</script>
{% endblock %}
