# æ³°æ‘¸é±¼å§ - æŠ€æœ¯è§„æ ¼æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

**æ³°æ‘¸é±¼å§** æ˜¯ä¸€ä¸ªåŸºäºFlaskçš„DBAæ•°æ®åº“ç®¡ç†Webåº”ç”¨ï¼Œæä¾›å¤šæ•°æ®åº“å®ä¾‹ç®¡ç†ã€è´¦æˆ·ç®¡ç†ã€ä»»åŠ¡è°ƒåº¦ã€æ—¥å¿—ç›‘æ§ç­‰åŠŸèƒ½ã€‚æ”¯æŒPostgreSQLã€MySQLã€SQL Serverã€Oracleç­‰ä¸»æµæ•°æ®åº“ã€‚

### æ ¸å¿ƒç‰¹æ€§

- ğŸ” **ç”¨æˆ·è®¤è¯ä¸æƒé™ç®¡ç†** - åŸºäºFlask-Loginçš„ä¼šè¯ç®¡ç†ï¼Œæ”¯æŒJWTä»¤ç‰Œè®¤è¯
- ğŸ—„ï¸ **å¤šæ•°æ®åº“å®ä¾‹ç®¡ç†** - æ”¯æŒPostgreSQLã€MySQLã€SQL Serverã€Oracle
- ğŸ‘¥ **è´¦æˆ·ä¿¡æ¯ç®¡ç†** - æ•°æ®åº“ç”¨æˆ·è´¦æˆ·åŒæ­¥ä¸ç®¡ç†ï¼Œæ”¯æŒæƒé™ä¿¡æ¯å®æ—¶æŸ¥è¯¢
- ğŸ·ï¸ **è´¦æˆ·åˆ†ç±»ç®¡ç†** - æ™ºèƒ½è´¦æˆ·åˆ†ç±»ä¸æƒé™è§„åˆ™ç®¡ç†
  - ğŸ¯ è‡ªåŠ¨åˆ†ç±» - åŸºäºæƒé™è§„åˆ™è‡ªåŠ¨åˆ†ç±»è´¦æˆ·
  - ğŸ“‹ åˆ†ç±»è§„åˆ™ - æ”¯æŒMySQLã€SQL Serverã€PostgreSQLã€Oracleæƒé™è§„åˆ™
  - ğŸ” æƒé™æ‰«æ - å®æ—¶æ‰«æè´¦æˆ·æƒé™ä¿¡æ¯
  - ğŸ“Š åˆ†ç±»ç»Ÿè®¡ - é«˜é£é™©è´¦æˆ·ã€ç‰¹æƒè´¦æˆ·ç»Ÿè®¡
  - âš™ï¸ è§„åˆ™ç®¡ç† - çµæ´»çš„æƒé™è§„åˆ™é…ç½®
  - ğŸ”„ å¤šåˆ†ç±»æ”¯æŒ - æ”¯æŒè´¦æˆ·åŒ¹é…å¤šä¸ªåˆ†ç±»è§„åˆ™
  - ğŸ”§ åŠŸèƒ½ä¿®å¤ - ä¿®å¤æƒé™æ˜¾ç¤ºã€åˆ†ç±»è§„åˆ™è¯„ä¼°ã€è´¦æˆ·ç®¡ç†é¡µé¢ç­‰é—®é¢˜
- ğŸ”‘ **å‡­æ®ç®¡ç†** - å®‰å…¨çš„æ•°æ®åº“è¿æ¥å‡­æ®å­˜å‚¨
- â° **å®šæ—¶ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ** - é«˜åº¦å¯å®šåˆ¶åŒ–çš„å®šæ—¶ä»»åŠ¡è°ƒåº¦å¹³å°
  - ğŸš€ å¿«é€Ÿåˆ›å»ºå†…ç½®ä»»åŠ¡ - ä¸€é”®åˆ›å»ºå¸¸ç”¨åŒæ­¥ä»»åŠ¡
  - ğŸ“Š æ‰¹é‡ä»»åŠ¡ç®¡ç† - æ”¯æŒæ‰¹é‡å¯ç”¨/ç¦ç”¨/æ‰§è¡Œä»»åŠ¡
  - ğŸ“ˆ æ‰§è¡Œç»Ÿè®¡ç›‘æ§ - è¯¦ç»†çš„è¿è¡Œç»Ÿè®¡å’ŒæˆåŠŸç‡åˆ†æ
  - ğŸ”„ å®æ—¶ä»»åŠ¡æ‰§è¡Œ - æ”¯æŒç«‹å³æ‰§è¡Œå’Œå®šæ—¶æ‰§è¡Œ
- ğŸ“ˆ **å®æ—¶ç›‘æ§ä»ªè¡¨æ¿** - ç³»ç»ŸçŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯
- ğŸ“ **æ“ä½œæ—¥å¿—è®°å½•** - å®Œæ•´çš„å®¡è®¡æ—¥å¿—
- ğŸš€ **RESTful API** - å®Œæ•´çš„APIæ¥å£

## æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|------|
| **åç«¯æ¡†æ¶** | Flask | 3.0.3 | Webåº”ç”¨æ¡†æ¶ |
| **æ¨¡æ¿å¼•æ“** | Jinja2 | 3.1.4 | æ¨¡æ¿æ¸²æŸ“ |
| **WSGIæœåŠ¡å™¨** | Werkzeug | 3.0.3 | WSGIå·¥å…·åŒ… |
| **æ•°æ®åº“ORM** | SQLAlchemy | 2.0.30 | æ•°æ®åº“ORM |
| **æ•°æ®åº“è¿ç§»** | Flask-Migrate | 4.0.7 | æ•°æ®åº“ç‰ˆæœ¬ç®¡ç† |
| **ç”¨æˆ·è®¤è¯** | Flask-Login | 0.6.3 | ç”¨æˆ·ä¼šè¯ç®¡ç† |
| **å¯†ç åŠ å¯†** | Flask-Bcrypt | 1.0.1 | å¯†ç å“ˆå¸Œ |
| **JWTè®¤è¯** | Flask-JWT-Extended | 4.6.0 | JWTä»¤ç‰Œç®¡ç† |
| **ç¼“å­˜ç³»ç»Ÿ** | Flask-Caching | 2.1.0 | ç¼“å­˜ç®¡ç† |
| **ä»»åŠ¡è°ƒåº¦** | APScheduler | 3.10.4 | å®šæ—¶ä»»åŠ¡è°ƒåº¦ |
| **æ¶ˆæ¯ä»£ç†** | Redis | 8.2.1 | ç¼“å­˜å’Œæ¶ˆæ¯é˜Ÿåˆ— |
| **å‰ç«¯æ¡†æ¶** | Bootstrap | 5.3.2 | UIç»„ä»¶åº“ |
| **å›¾æ ‡åº“** | Font Awesome | 6.4.0 | å›¾æ ‡åº“ |
| **æ—¶åŒºå¤„ç†** | pytz | 2023.3 | æ—¶åŒºè½¬æ¢ |

### æ•°æ®åº“æ”¯æŒ

| æ•°æ®åº“ | é©±åŠ¨ | ç‰ˆæœ¬ | çŠ¶æ€ | æƒé™æ”¯æŒ |
|--------|------|------|------|----------|
| **PostgreSQL** | psycopg2-binary | 2.9.9 | âœ… å®Œå…¨æ”¯æŒ | è§’è‰²å±æ€§ã€æ•°æ®åº“æƒé™ã€è¡¨ç©ºé—´æƒé™ |
| **MySQL** | PyMySQL | 1.1.1 | âœ… å®Œå…¨æ”¯æŒ | å…¨å±€æƒé™ã€æ•°æ®åº“æƒé™ |
| **SQL Server** | pyodbc | 5.1.0 | âœ… å®Œå…¨æ”¯æŒ | æœåŠ¡å™¨è§’è‰²ã€æœåŠ¡å™¨æƒé™ã€æ•°æ®åº“è§’è‰²ã€æ•°æ®åº“æƒé™ |
| **SQL Server** | pymssql | 2.2.11 | âœ… å®Œå…¨æ”¯æŒ | æœåŠ¡å™¨è§’è‰²ã€æœåŠ¡å™¨æƒé™ã€æ•°æ®åº“è§’è‰²ã€æ•°æ®åº“æƒé™ |
| **Oracle** | python-oracledb | 2.0.0 | âœ… å®Œå…¨æ”¯æŒ | ç³»ç»Ÿæƒé™ã€è§’è‰²ã€è¡¨ç©ºé—´æƒé™ã€è¡¨ç©ºé—´é…é¢ |

### æ•°æ®åº“ç±»å‹æŠ½è±¡æ¶æ„

#### è®¾è®¡ç›®æ ‡
- **ç»Ÿä¸€ç®¡ç†**: é›†ä¸­ç®¡ç†æ‰€æœ‰æ•°æ®åº“ç±»å‹é…ç½®
- **åŠ¨æ€æ‰©å±•**: æ”¯æŒé€šè¿‡ç•Œé¢åŠ¨æ€æ·»åŠ æ–°æ•°æ®åº“ç±»å‹
- **ç±»å‹å®‰å…¨**: ä½¿ç”¨æšä¸¾å’ŒéªŒè¯ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- **é…ç½®å¤ç”¨**: é¿å…é‡å¤é…ç½®ä¿¡æ¯
- **ç»´æŠ¤ç®€å•**: ä¿®æ”¹é…ç½®åªéœ€åœ¨ä¸€ä¸ªåœ°æ–¹

#### æ ¸å¿ƒç»„ä»¶

##### 1. æ•°æ®åº“ç±»å‹ç®¡ç†å™¨ (DatabaseTypeManager)
```python
# æ ¸å¿ƒåŠŸèƒ½
- æ•°æ®åº“ç±»å‹é…ç½®ç®¡ç†
- æ”¯æŒçŠ¶æ€æ§åˆ¶
- ç‰¹æ€§æ ‡ç­¾ç®¡ç†
- æ’åºå’Œæ˜¾ç¤ºæ§åˆ¶
- ç³»ç»Ÿå†…ç½®ç±»å‹ä¿æŠ¤
```

##### 2. è¿æ¥å·¥å‚æ¨¡å¼ (ConnectionFactory)
```python
# è®¾è®¡æ¨¡å¼
- æŠ½è±¡è¿æ¥å·¥å‚åŸºç±»
- å…·ä½“æ•°æ®åº“è¿æ¥å®ç°
- ç»Ÿä¸€è¿æ¥ç®¡ç†æ¥å£
- è¿æ¥æ± ç®¡ç†
- è¿æ¥æµ‹è¯•å’ŒéªŒè¯
```

##### 3. æƒé™æŸ¥è¯¢æŠ½è±¡ (PermissionQueryFactory)
```python
# æƒé™ç®¡ç†
- ç»Ÿä¸€æƒé™æŸ¥è¯¢æ¥å£
- æ•°æ®åº“ç‰¹å®šæƒé™å®ç°
- æƒé™æ•°æ®æ ‡å‡†åŒ–
- æƒé™è§„åˆ™ç®¡ç†
```

#### æ•°æ®åº“ç±»å‹é…ç½®æ¨¡å‹

```mermaid
erDiagram
    DatabaseTypeConfig {
        int id PK
        string name UK "æ•°æ®åº“ç±»å‹åç§°"
        string display_name "æ˜¾ç¤ºåç§°"
        string driver "é©±åŠ¨åç§°"
        int default_port "é»˜è®¤ç«¯å£"
        string default_schema "é»˜è®¤Schema"
        int connection_timeout "è¿æ¥è¶…æ—¶"
        text description "æè¿°ä¿¡æ¯"
        string icon "å›¾æ ‡ç±»å"
        string color "ä¸»é¢˜é¢œè‰²"
        text features "ç‰¹æ€§åˆ—è¡¨(JSON)"
        boolean is_active "æ˜¯å¦å¯ç”¨"
        boolean is_system "æ˜¯å¦ç³»ç»Ÿå†…ç½®"
        int sort_order "æ’åºé¡ºåº"
        datetime created_at "åˆ›å»ºæ—¶é—´"
        datetime updated_at "æ›´æ–°æ—¶é—´"
    }

    Instance }o--|| DatabaseTypeConfig : uses
    Task }o--|| DatabaseTypeConfig : targets
```

#### ç³»ç»Ÿæ¶æ„æ›´æ–°

```mermaid
graph TB
    subgraph "å‰ç«¯å±‚"
        A[Webæµè§ˆå™¨] --> B[Bootstrap UI]
        B --> C[JavaScript/AJAX]
        C --> D[æ•°æ®åº“ç±»å‹ç®¡ç†ç•Œé¢]
        C --> E[å®ä¾‹ç®¡ç†ç•Œé¢]
        C --> F[ä»»åŠ¡ç®¡ç†ç•Œé¢]
    end

    subgraph "åº”ç”¨å±‚"
        D --> G[Flaskåº”ç”¨]
        E --> G
        F --> G
        G --> H[è·¯ç”±æ§åˆ¶å™¨]
        H --> I[ä¸šåŠ¡é€»è¾‘å±‚]
        I --> J[æœåŠ¡å±‚]
        J --> K[æ•°æ®åº“ç±»å‹æœåŠ¡]
        J --> L[è¿æ¥å·¥å‚]
        J --> M[æƒé™æŸ¥è¯¢å·¥å‚]
    end

    subgraph "æ•°æ®å±‚"
        J --> N[SQLAlchemy ORM]
        N --> O[SQLite/PostgreSQL]
        J --> P[Redisç¼“å­˜]
        J --> Q[æ–‡ä»¶å­˜å‚¨]
    end

    subgraph "æ•°æ®åº“ç±»å‹ç®¡ç†"
        K --> R[DatabaseTypeConfig]
        R --> S[ç³»ç»Ÿå†…ç½®ç±»å‹]
        R --> T[è‡ªå®šä¹‰ç±»å‹]
        L --> U[MySQLè¿æ¥å·¥å‚]
        L --> V[PostgreSQLè¿æ¥å·¥å‚]
        L --> W[SQL Serverè¿æ¥å·¥å‚]
        L --> X[Oracleè¿æ¥å·¥å‚]
    end

    subgraph "å¤–éƒ¨æ•°æ®åº“"
        Y[PostgreSQLå®ä¾‹]
        Z[MySQLå®ä¾‹]
        AA[SQL Serverå®ä¾‹]
        BB[Oracleå®ä¾‹]
        CC[å…¶ä»–æ•°æ®åº“å®ä¾‹]
    end

    U --> Z
    V --> Y
    W --> AA
    X --> BB
    L --> CC
```

#### åŠŸèƒ½ç‰¹æ€§

##### æ•°æ®åº“ç±»å‹ç®¡ç†ç•Œé¢
- **åŠ¨æ€ç®¡ç†**: é€šè¿‡ç•Œé¢æ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤æ•°æ®åº“ç±»å‹
- **ç³»ç»Ÿä¿æŠ¤**: ç³»ç»Ÿå†…ç½®ç±»å‹ä¸èƒ½åˆ é™¤ï¼Œåªèƒ½ä¿®æ”¹éƒ¨åˆ†å­—æ®µ
- **çŠ¶æ€æ§åˆ¶**: å¯ä»¥å¯ç”¨/ç¦ç”¨æ•°æ®åº“ç±»å‹
- **æ’åºç®¡ç†**: æ”¯æŒè‡ªå®šä¹‰æ’åºé¡ºåº
- **ç‰¹æ€§æ ‡è¯†**: æ”¯æŒä¸ºæ¯ä¸ªæ•°æ®åº“ç±»å‹æ·»åŠ ç‰¹æ€§æ ‡ç­¾
- **ä½¿ç”¨æ£€æŸ¥**: åˆ é™¤å‰æ£€æŸ¥æ˜¯å¦æœ‰å®ä¾‹åœ¨ä½¿ç”¨

##### è¿æ¥ç®¡ç†ä¼˜åŒ–
- **ç»Ÿä¸€æ¥å£**: æ‰€æœ‰æ•°æ®åº“è¿æ¥é€šè¿‡ç»Ÿä¸€æ¥å£åˆ›å»º
- **è¿æ¥æ± **: æ”¯æŒè¿æ¥æ± ç®¡ç†ï¼Œæé«˜æ€§èƒ½
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- **è¿æ¥æµ‹è¯•**: è‡ªåŠ¨è¿æ¥æµ‹è¯•å’ŒéªŒè¯

##### æƒé™æŸ¥è¯¢æ ‡å‡†åŒ–
- **ç»Ÿä¸€æ ¼å¼**: æ‰€æœ‰æ•°æ®åº“æƒé™æŸ¥è¯¢è¿”å›ç»Ÿä¸€æ ¼å¼
- **ç±»å‹å®‰å…¨**: ä½¿ç”¨å¼ºç±»å‹ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- **æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°çš„æ•°æ®åº“ç±»å‹æ”¯æŒ

### ç³»ç»Ÿæ¶æ„å›¾

```mermaid
graph TB
    subgraph "å‰ç«¯å±‚"
        A[Webæµè§ˆå™¨] --> B[Bootstrap UI]
        B --> C[JavaScript/AJAX]
        C --> D[ä»»åŠ¡ç®¡ç†ç•Œé¢]
        C --> E[æ‰¹é‡æ“ä½œç•Œé¢]
        C --> F[å¿«é€Ÿåˆ›å»ºç•Œé¢]
    end

    subgraph "åº”ç”¨å±‚"
        D --> G[Flaskåº”ç”¨]
        E --> G
        F --> G
        G --> H[è·¯ç”±æ§åˆ¶å™¨]
        H --> I[ä¸šåŠ¡é€»è¾‘å±‚]
        I --> J[æœåŠ¡å±‚]
        J --> K[ä»»åŠ¡è°ƒåº¦æœåŠ¡]
    end

    subgraph "æ•°æ®å±‚"
        J --> L[SQLAlchemy ORM]
        L --> M[SQLite/PostgreSQL]
        J --> N[Redisç¼“å­˜]
        J --> O[æ–‡ä»¶å­˜å‚¨]
    end

    subgraph "ä»»åŠ¡æ‰§è¡Œå±‚"
        K --> P[ä»»åŠ¡æ‰§è¡Œå™¨]
        P --> Q[æ‰¹é‡ä»»åŠ¡å¤„ç†å™¨]
        P --> R[å¿«é€Ÿä»»åŠ¡åˆ›å»ºå™¨]
        P --> S[æ•°æ®åº“è¿æ¥æ± ]
        S --> T[å¤–éƒ¨æ•°æ®åº“]
    end

    subgraph "å¤–éƒ¨ç³»ç»Ÿ"
        U[PostgreSQLå®ä¾‹]
        V[MySQLå®ä¾‹]
        W[SQL Serverå®ä¾‹]
        X[Oracleå®ä¾‹]
    end

    G --> K
    T --> U
    T --> V
    T --> W
    T --> X

    subgraph "ä»»åŠ¡ç±»å‹"
        Y[è´¦æˆ·åŒæ­¥ä»»åŠ¡]
        Z[ç‰ˆæœ¬åŒæ­¥ä»»åŠ¡]
        AA[å¤§å°åŒæ­¥ä»»åŠ¡]
        BB[è‡ªå®šä¹‰ä»»åŠ¡]
    end

    P --> Y
    P --> Z
    P --> AA
    P --> BB
```

## æ•°æ®æ¨¡å‹è®¾è®¡

### æ ¸å¿ƒå®ä½“å…³ç³»å›¾

```mermaid
erDiagram
    User ||--o{ Log : creates
    User ||--o{ Instance : manages
    User ||--o{ Credential : manages
    User ||--o{ Task : creates

    Instance ||--o{ Account : contains
    Instance ||--o{ SyncData : generates
    Instance }o--|| Credential : uses

    Credential ||--o{ Instance : authenticates

    Task ||--o{ SyncData : executes
    Task }o--|| Instance : targets

    Account }o--|| Instance : belongs_to

    User {
        int id PK
        string username UK
        string email UK
        string password_hash
        string role
        boolean is_active
        datetime created_at
        datetime updated_at
        datetime last_login
    }

    Instance {
        int id PK
        string name UK
        string db_type
        string host
        int port
        string database_name
        int credential_id FK
        text description
        json tags
        string status
        boolean is_active
        datetime last_connected
        datetime created_at
        datetime updated_at
        datetime deleted_at
    }

    Credential {
        int id PK
        string name UK
        string username
        string password
        string db_type
        text description
        json config
        boolean is_active
        datetime created_at
        datetime updated_at
    }

    Account {
        int id PK
        int instance_id FK
        string username
        string database_name
        string account_type
        boolean is_active
        datetime last_login
        datetime created_at
        datetime updated_at
        string host
        string plugin
        boolean password_expired
        datetime password_last_changed
        boolean is_locked
        text permissions
        boolean is_superuser
        boolean can_grant
    }

    Task {
        int id PK
        string name UK
        string task_type
        string db_type
        string schedule
        text description
        text python_code
        json config
        boolean is_active
        boolean is_builtin
        datetime last_run
        string last_status
        text last_message
        int run_count
        int success_count
        datetime created_at
        datetime updated_at
    }

    Log {
        int id PK
        int user_id FK
        string operation
        string resource_type
        int resource_id
        text details
        string ip_address
        string user_agent
        datetime created_at
    }

    SyncData {
        int id PK
        int instance_id FK
        int task_id FK
        string sync_type
        string status
        text message
        int synced_count
        datetime created_at
    }

    GlobalParam {
        int id PK
        string key UK
        text value
        string description
        string category
        boolean is_encrypted
        datetime created_at
        datetime updated_at
    }

    AccountClassification {
        int id PK
        string name UK
        text description
        string risk_level
        string color
        int priority
        boolean is_active
        boolean is_system
        datetime created_at
        datetime updated_at
    }

    ClassificationRule {
        int id PK
        int classification_id FK
        string db_type
        string rule_name
        text rule_expression
        boolean is_active
        datetime created_at
        datetime updated_at
    }

    AccountClassificationAssignment {
        int id PK
        int account_id FK
        int classification_id FK
        int assigned_by FK
        string assignment_type
        float confidence_score
        text notes
        boolean is_active
        datetime created_at
        datetime updated_at
    }

    PermissionConfig {
        int id PK
        string db_type
        string category
        string permission_name
        text description
        boolean is_active
        int sort_order
        datetime created_at
        datetime updated_at
    }
```

### æ•°æ®æ¨¡å‹è¯¦ç»†è¯´æ˜

#### 1. ç”¨æˆ·æ¨¡å‹ (User)
- **åŠŸèƒ½**: ç³»ç»Ÿç”¨æˆ·ç®¡ç†
- **å­—æ®µ**: ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç å“ˆå¸Œã€è§’è‰²ã€çŠ¶æ€ç­‰
- **å…³ç³»**: ä¸€å¯¹å¤šå…³è”æ—¥å¿—ã€å®ä¾‹ã€å‡­æ®ã€ä»»åŠ¡

#### 2. å®ä¾‹æ¨¡å‹ (Instance)
- **åŠŸèƒ½**: æ•°æ®åº“å®ä¾‹ç®¡ç†
- **å­—æ®µ**: å®ä¾‹åã€æ•°æ®åº“ç±»å‹ã€è¿æ¥ä¿¡æ¯ã€çŠ¶æ€ç­‰
- **å…³ç³»**: å¤šå¯¹ä¸€å…³è”å‡­æ®ï¼Œä¸€å¯¹å¤šå…³è”è´¦æˆ·ã€åŒæ­¥æ•°æ®

#### 3. å‡­æ®æ¨¡å‹ (Credential)
- **åŠŸèƒ½**: æ•°æ®åº“è¿æ¥å‡­æ®ç®¡ç†
- **å­—æ®µ**: å‡­æ®åã€ç”¨æˆ·åã€å¯†ç ã€æ•°æ®åº“ç±»å‹ç­‰
- **å…³ç³»**: ä¸€å¯¹å¤šå…³è”å®ä¾‹

#### 4. è´¦æˆ·æ¨¡å‹ (Account)
- **åŠŸèƒ½**: æ•°æ®åº“ç”¨æˆ·è´¦æˆ·ç®¡ç†
- **å­—æ®µ**: ç”¨æˆ·åã€æ•°æ®åº“åã€è´¦æˆ·ç±»å‹ã€çŠ¶æ€ç­‰
- **å…³ç³»**: å¤šå¯¹ä¸€å…³è”å®ä¾‹

#### 5. ä»»åŠ¡æ¨¡å‹ (Task)
- **åŠŸèƒ½**: ä»»åŠ¡è°ƒåº¦ç®¡ç†
- **å­—æ®µ**: ä»»åŠ¡åã€ç±»å‹ã€æ•°æ®åº“ç±»å‹ã€Pythonä»£ç ã€é…ç½®ç­‰
- **å…³ç³»**: ä¸€å¯¹å¤šå…³è”åŒæ­¥æ•°æ®

#### 6. æ—¥å¿—æ¨¡å‹ (Log)
- **åŠŸèƒ½**: æ“ä½œå®¡è®¡æ—¥å¿—
- **å­—æ®µ**: æ“ä½œç”¨æˆ·ã€æ“ä½œç±»å‹ã€èµ„æºä¿¡æ¯ã€è¯¦æƒ…ç­‰
- **å…³ç³»**: å¤šå¯¹ä¸€å…³è”ç”¨æˆ·

#### 7. åŒæ­¥æ•°æ®æ¨¡å‹ (SyncData)
- **åŠŸèƒ½**: æ•°æ®åŒæ­¥è®°å½•
- **å­—æ®µ**: åŒæ­¥ç±»å‹ã€çŠ¶æ€ã€æ¶ˆæ¯ã€åŒæ­¥æ•°é‡ç­‰
- **å…³ç³»**: å¤šå¯¹ä¸€å…³è”å®ä¾‹å’Œä»»åŠ¡

#### 8. å…¨å±€å‚æ•°æ¨¡å‹ (GlobalParam)
- **åŠŸèƒ½**: ç³»ç»Ÿé…ç½®å‚æ•°ç®¡ç†
- **å­—æ®µ**: å‚æ•°é”®ã€å€¼ã€æè¿°ã€åˆ†ç±»ã€åŠ å¯†çŠ¶æ€ç­‰

#### 9. è´¦æˆ·åˆ†ç±»æ¨¡å‹ (AccountClassification)
- **åŠŸèƒ½**: è´¦æˆ·åˆ†ç±»å®šä¹‰ç®¡ç†
- **å­—æ®µ**: åˆ†ç±»åã€æè¿°ã€é£é™©çº§åˆ«ã€é¢œè‰²ã€ä¼˜å…ˆçº§ã€ç³»ç»Ÿæ ‡è¯†ç­‰
- **å…³ç³»**: ä¸€å¯¹å¤šå…³è”åˆ†ç±»è§„åˆ™å’Œåˆ†ç±»åˆ†é…

#### 10. åˆ†ç±»è§„åˆ™æ¨¡å‹ (ClassificationRule)
- **åŠŸèƒ½**: è´¦æˆ·åˆ†ç±»è§„åˆ™å®šä¹‰
- **å­—æ®µ**: è§„åˆ™åã€æ•°æ®åº“ç±»å‹ã€è§„åˆ™è¡¨è¾¾å¼ã€çŠ¶æ€ç­‰
- **å…³ç³»**: å¤šå¯¹ä¸€å…³è”è´¦æˆ·åˆ†ç±»

#### 11. è´¦æˆ·åˆ†ç±»åˆ†é…æ¨¡å‹ (AccountClassificationAssignment)
- **åŠŸèƒ½**: è´¦æˆ·ä¸åˆ†ç±»çš„å…³è”å…³ç³»
- **å­—æ®µ**: åˆ†é…ç±»å‹ã€ç½®ä¿¡åº¦ã€å¤‡æ³¨ã€çŠ¶æ€ç­‰
- **å…³ç³»**: å¤šå¯¹ä¸€å…³è”è´¦æˆ·å’Œåˆ†ç±»

#### 12. æƒé™é…ç½®æ¨¡å‹ (PermissionConfig)
- **åŠŸèƒ½**: æ•°æ®åº“æƒé™é…ç½®ç®¡ç†
- **å­—æ®µ**: æ•°æ®åº“ç±»å‹ã€æƒé™ç±»åˆ«ã€æƒé™åã€æè¿°ã€æ’åºç­‰

## APIæ¥å£è®¾è®¡

### è®¤è¯æ¥å£

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | è®¤è¯ |
|------|------|------|------|
| POST | `/auth/login` | ç”¨æˆ·ç™»å½• | æ—  |
| POST | `/auth/logout` | ç”¨æˆ·ç™»å‡º | éœ€è¦ |
| POST | `/auth/register` | ç”¨æˆ·æ³¨å†Œ | æ—  |
| POST | `/auth/change-password` | ä¿®æ”¹å¯†ç  | éœ€è¦ |

### å®ä¾‹ç®¡ç†æ¥å£

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | è®¤è¯ |
|------|------|------|------|
| GET | `/instances/` | è·å–å®ä¾‹åˆ—è¡¨ | éœ€è¦ |
| POST | `/instances/create` | åˆ›å»ºå®ä¾‹ | éœ€è¦ |
| GET | `/instances/<id>` | è·å–å®ä¾‹è¯¦æƒ… | éœ€è¦ |
| PUT | `/instances/<id>/edit` | æ›´æ–°å®ä¾‹ | éœ€è¦ |
| DELETE | `/instances/<id>/delete` | åˆ é™¤å®ä¾‹ | éœ€è¦ |
| POST | `/instances/<id>/test-connection` | æµ‹è¯•è¿æ¥ | éœ€è¦ |
| GET | `/instances/statistics` | å®ä¾‹ç»Ÿè®¡ | éœ€è¦ |

### å‡­æ®ç®¡ç†æ¥å£

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | è®¤è¯ |
|------|------|------|------|
| GET | `/credentials/` | è·å–å‡­æ®åˆ—è¡¨ | éœ€è¦ |
| POST | `/credentials/create` | åˆ›å»ºå‡­æ® | éœ€è¦ |
| GET | `/credentials/<id>` | è·å–å‡­æ®è¯¦æƒ… | éœ€è¦ |
| PUT | `/credentials/<id>/edit` | æ›´æ–°å‡­æ® | éœ€è¦ |
| DELETE | `/credentials/<id>/delete` | åˆ é™¤å‡­æ® | éœ€è¦ |
| POST | `/credentials/<id>/toggle` | å¯ç”¨/ç¦ç”¨å‡­æ® | éœ€è¦ |

### è´¦æˆ·ç®¡ç†æ¥å£

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | è®¤è¯ |
|------|------|------|------|
| GET | `/accounts/` | è´¦æˆ·ç»Ÿè®¡é¦–é¡µ | éœ€è¦ |
| GET | `/accounts/list` | è´¦æˆ·åˆ—è¡¨ | éœ€è¦ |
| GET | `/accounts/api/statistics` | è´¦æˆ·ç»Ÿè®¡API | éœ€è¦ |

### ä»»åŠ¡ç®¡ç†æ¥å£

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | è®¤è¯ | è¯´æ˜ |
|------|------|------|------|------|
| GET | `/tasks/` | è·å–ä»»åŠ¡åˆ—è¡¨ | éœ€è¦ | æ”¯æŒåˆ†é¡µå’Œç­›é€‰ |
| POST | `/tasks/create` | åˆ›å»ºä»»åŠ¡ | éœ€è¦ | åˆ›å»ºè‡ªå®šä¹‰ä»»åŠ¡ |
| GET | `/tasks/<id>` | è·å–ä»»åŠ¡è¯¦æƒ… | éœ€è¦ | è·å–å•ä¸ªä»»åŠ¡ä¿¡æ¯ |
| PUT | `/tasks/<id>/edit` | æ›´æ–°ä»»åŠ¡ | éœ€è¦ | æ›´æ–°ä»»åŠ¡é…ç½® |
| DELETE | `/tasks/<id>/delete` | åˆ é™¤ä»»åŠ¡ | éœ€è¦ | åˆ é™¤æŒ‡å®šä»»åŠ¡ |
| POST | `/tasks/<id>/toggle` | å¯ç”¨/ç¦ç”¨ä»»åŠ¡ | éœ€è¦ | åˆ‡æ¢ä»»åŠ¡çŠ¶æ€ |
| POST | `/tasks/<id>/execute` | æ‰§è¡Œä»»åŠ¡ | éœ€è¦ | ç«‹å³æ‰§è¡Œå•ä¸ªä»»åŠ¡ |
| POST | `/tasks/create-builtin` | åˆ›å»ºå†…ç½®ä»»åŠ¡ | éœ€è¦ | åˆ›å»ºæ‰€æœ‰å†…ç½®ä»»åŠ¡ |
| POST | `/tasks/create-quick` | å¿«é€Ÿåˆ›å»ºä»»åŠ¡ | éœ€è¦ | æŒ‰ç±»å‹å¿«é€Ÿåˆ›å»ºä»»åŠ¡ |
| POST | `/tasks/batch-toggle` | æ‰¹é‡å¯ç”¨/ç¦ç”¨ | éœ€è¦ | æ‰¹é‡åˆ‡æ¢ä»»åŠ¡çŠ¶æ€ |
| POST | `/tasks/batch-execute` | æ‰¹é‡æ‰§è¡Œä»»åŠ¡ | éœ€è¦ | æ‰¹é‡æ‰§è¡Œé€‰ä¸­ä»»åŠ¡ |
| POST | `/tasks/execute-all` | æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡ | éœ€è¦ | æ‰§è¡Œæ‰€æœ‰æ´»è·ƒä»»åŠ¡ |

### è´¦æˆ·åˆ†ç±»ç®¡ç†æ¥å£

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | è®¤è¯ | è¯´æ˜ |
|------|------|------|------|------|
| GET | `/account-classification/` | åˆ†ç±»ç®¡ç†é¦–é¡µ | éœ€è¦ | æ˜¾ç¤ºåˆ†ç±»å’Œè§„åˆ™åˆ—è¡¨ |
| GET | `/account-classification/classifications` | è·å–åˆ†ç±»åˆ—è¡¨ | éœ€è¦ | è·å–æ‰€æœ‰è´¦æˆ·åˆ†ç±» |
| POST | `/account-classification/classifications` | åˆ›å»ºåˆ†ç±» | éœ€è¦ | åˆ›å»ºæ–°çš„è´¦æˆ·åˆ†ç±» |
| PUT | `/account-classification/classifications/<id>` | æ›´æ–°åˆ†ç±» | éœ€è¦ | æ›´æ–°åˆ†ç±»ä¿¡æ¯ |
| DELETE | `/account-classification/classifications/<id>` | åˆ é™¤åˆ†ç±» | éœ€è¦ | åˆ é™¤æŒ‡å®šåˆ†ç±» |
| GET | `/account-classification/rules` | è·å–è§„åˆ™åˆ—è¡¨ | éœ€è¦ | è·å–æ‰€æœ‰åˆ†ç±»è§„åˆ™ |
| POST | `/account-classification/rules` | åˆ›å»ºè§„åˆ™ | éœ€è¦ | åˆ›å»ºæ–°çš„åˆ†ç±»è§„åˆ™ |
| PUT | `/account-classification/rules/<id>` | æ›´æ–°è§„åˆ™ | éœ€è¦ | æ›´æ–°è§„åˆ™é…ç½® |
| DELETE | `/account-classification/rules/<id>` | åˆ é™¤è§„åˆ™ | éœ€è¦ | åˆ é™¤æŒ‡å®šè§„åˆ™ |
| POST | `/account-classification/auto-classify` | è‡ªåŠ¨åˆ†ç±» | éœ€è¦ | æ‰§è¡Œè‡ªåŠ¨åˆ†ç±»æ“ä½œ |
| GET | `/account-classification/permissions/<db_type>` | è·å–æƒé™é…ç½® | éœ€è¦ | è·å–æŒ‡å®šæ•°æ®åº“ç±»å‹çš„æƒé™é…ç½® |

### ç³»ç»Ÿç®¡ç†æ¥å£

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | è®¤è¯ |
|------|------|------|------|
| GET | `/dashboard/` | ä»ªè¡¨æ¿é¦–é¡µ | éœ€è¦ |
| GET | `/dashboard/api/overview` | ç³»ç»Ÿæ¦‚è§ˆAPI | éœ€è¦ |
| GET | `/logs/` | æ—¥å¿—ç®¡ç† | éœ€è¦ |
| GET | `/params/` | å‚æ•°ç®¡ç† | éœ€è¦ |
| GET | `/admin/` | ç®¡ç†åå° | éœ€è¦ |

### å¥åº·æ£€æŸ¥æ¥å£

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | è®¤è¯ |
|------|------|------|------|
| GET | `/api/health` | ç³»ç»Ÿå¥åº·æ£€æŸ¥ | æ—  |

## å®šæ—¶ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ

### ç³»ç»Ÿæ¦‚è¿°

æ³°æ‘¸é±¼å§çš„å®šæ—¶ä»»åŠ¡ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªé«˜åº¦å¯å®šåˆ¶åŒ–çš„ä»»åŠ¡è°ƒåº¦å¹³å°ï¼Œæ”¯æŒå¤šç§æ•°æ®åº“ç±»å‹çš„è‡ªåŠ¨åŒ–åŒæ­¥ä»»åŠ¡ã€‚ç³»ç»Ÿæä¾›äº†ç›´è§‚çš„Webç•Œé¢å’Œå¼ºå¤§çš„APIæ¥å£ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿè½»æ¾åˆ›å»ºã€ç®¡ç†å’Œç›‘æ§å„ç§å®šæ—¶ä»»åŠ¡ã€‚

### æ ¸å¿ƒåŠŸèƒ½

- ğŸš€ **å¿«é€Ÿåˆ›å»ºå†…ç½®ä»»åŠ¡** - ä¸€é”®åˆ›å»ºå¸¸ç”¨åŒæ­¥ä»»åŠ¡
- â° **å®šæ—¶ä»»åŠ¡è°ƒåº¦** - æ”¯æŒCronè¡¨è¾¾å¼çš„å®šæ—¶æ‰§è¡Œ
- ğŸ“Š **æ‰¹é‡ä»»åŠ¡ç®¡ç†** - æ”¯æŒæ‰¹é‡å¯ç”¨/ç¦ç”¨/æ‰§è¡Œä»»åŠ¡
- ğŸ“ˆ **æ‰§è¡Œç»Ÿè®¡ç›‘æ§** - è¯¦ç»†çš„è¿è¡Œç»Ÿè®¡å’ŒæˆåŠŸç‡åˆ†æ
- ğŸ”„ **å®æ—¶ä»»åŠ¡æ‰§è¡Œ** - æ”¯æŒç«‹å³æ‰§è¡Œå’Œå®šæ—¶æ‰§è¡Œ
- ğŸ¯ **æ™ºèƒ½ä»»åŠ¡åŒ¹é…** - æ ¹æ®æ•°æ®åº“ç±»å‹è‡ªåŠ¨åŒ¹é…å®ä¾‹

### ä»»åŠ¡ç±»å‹

| ç±»å‹ | åŠŸèƒ½ | æ•°æ®åº“æ”¯æŒ | è°ƒåº¦é¢‘ç‡ | è¯´æ˜ |
|------|------|------------|----------|------|
| **sync_accounts** | è´¦æˆ·åŒæ­¥ | PostgreSQL, MySQL, SQL Server, Oracle | æ¯6å°æ—¶ | åŒæ­¥æ•°æ®åº“ç”¨æˆ·è´¦æˆ·ä¿¡æ¯ |
| **sync_version** | ç‰ˆæœ¬åŒæ­¥ | PostgreSQL, MySQL, SQL Server, Oracle | æ¯å¤© | åŒæ­¥æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯ |
| **sync_size** | å¤§å°åŒæ­¥ | PostgreSQL, MySQL, SQL Server, Oracle | æ¯å¤©å‡Œæ™¨2ç‚¹ | åŒæ­¥æ•°æ®åº“å¤§å°ä¿¡æ¯ |
| **custom** | è‡ªå®šä¹‰ä»»åŠ¡ | å…¨éƒ¨ | ç”¨æˆ·å®šä¹‰ | ç”¨æˆ·è‡ªå®šä¹‰Pythonä»£ç  |

### ä»»åŠ¡æ‰§è¡Œæµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant W as Webç•Œé¢
    participant T as ä»»åŠ¡è°ƒåº¦å™¨
    participant E as ä»»åŠ¡æ‰§è¡Œå™¨
    participant D as æ•°æ®åº“
    participant I as å¤–éƒ¨å®ä¾‹

    U->>W: è®¿é—®ä»»åŠ¡ç®¡ç†é¡µé¢
    W->>U: æ˜¾ç¤ºå¿«é€Ÿåˆ›å»ºé€‰é¡¹

    alt å¿«é€Ÿåˆ›å»ºä»»åŠ¡
        U->>W: ç‚¹å‡»å¿«é€Ÿåˆ›å»ºæŒ‰é’®
        W->>T: è°ƒç”¨å¿«é€Ÿåˆ›å»ºAPI
        T->>D: åˆ›å»ºä»»åŠ¡è®°å½•
        T-->>W: è¿”å›åˆ›å»ºç»“æœ
        W-->>U: æ˜¾ç¤ºåˆ›å»ºæˆåŠŸ
    end

    alt æ‰¹é‡æ“ä½œ
        U->>W: é€‰æ‹©å¤šä¸ªä»»åŠ¡
        U->>W: ç‚¹å‡»æ‰¹é‡æ“ä½œæŒ‰é’®
        W->>T: è°ƒç”¨æ‰¹é‡æ“ä½œAPI
        T->>D: æ‰¹é‡æ›´æ–°ä»»åŠ¡çŠ¶æ€
        T-->>W: è¿”å›æ“ä½œç»“æœ
        W-->>U: æ˜¾ç¤ºæ“ä½œæˆåŠŸ
    end

    alt ä»»åŠ¡æ‰§è¡Œ
        U->>W: è§¦å‘ä»»åŠ¡æ‰§è¡Œ
        W->>T: è°ƒç”¨ä»»åŠ¡æ‰§è¡ŒAPI
        T->>E: æ‰§è¡Œä»»åŠ¡
        E->>D: æŸ¥è¯¢åŒ¹é…å®ä¾‹
        D-->>E: è¿”å›å®ä¾‹åˆ—è¡¨

        loop éå†æ¯ä¸ªå®ä¾‹
            E->>I: è¿æ¥æ•°æ®åº“
            E->>E: æ‰§è¡ŒPythonä»£ç 
            E->>D: ä¿å­˜åŒæ­¥æ•°æ®
            E->>D: æ›´æ–°ä»»åŠ¡ç»Ÿè®¡
        end

        E-->>T: è¿”å›æ‰§è¡Œç»“æœ
        T-->>W: æ›´æ–°ä»»åŠ¡çŠ¶æ€
        W-->>U: æ˜¾ç¤ºæ‰§è¡ŒçŠ¶æ€
    end
```

### ç”¨æˆ·ç•Œé¢åŠŸèƒ½

#### ä»»åŠ¡ç®¡ç†ä¸»é¡µé¢
- **å¿«é€Ÿåˆ›å»ºåŒºåŸŸ**: æä¾›4ä¸ªå¿«é€Ÿåˆ›å»ºå¡ç‰‡ï¼Œæ”¯æŒä¸€é”®åˆ›å»ºå¸¸ç”¨ä»»åŠ¡ç±»å‹
- **ä»»åŠ¡åˆ—è¡¨**: æ˜¾ç¤ºæ‰€æœ‰ä»»åŠ¡çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬çŠ¶æ€ã€ç»Ÿè®¡ã€æœ€åè¿è¡Œæ—¶é—´ç­‰
- **æ‰¹é‡æ“ä½œ**: æ”¯æŒå…¨é€‰ã€æ‰¹é‡å¯ç”¨/ç¦ç”¨ã€æ‰¹é‡æ‰§è¡Œä»»åŠ¡
- **ç­›é€‰åŠŸèƒ½**: æŒ‰çŠ¶æ€ã€æ•°æ®åº“ç±»å‹ã€ä»»åŠ¡ç±»å‹ç­›é€‰ä»»åŠ¡

#### ä»»åŠ¡çŠ¶æ€æ˜¾ç¤º
- **å¯ç”¨/ç¦ç”¨çŠ¶æ€**: ç»¿è‰²è¡¨ç¤ºå¯ç”¨ï¼Œçº¢è‰²è¡¨ç¤ºç¦ç”¨
- **å®šæ—¶/æ‰‹åŠ¨çŠ¶æ€**: è“è‰²è¡¨ç¤ºå®šæ—¶ä»»åŠ¡ï¼Œç°è‰²è¡¨ç¤ºæ‰‹åŠ¨ä»»åŠ¡
- **æ‰§è¡Œç»“æœ**: æˆåŠŸæ˜¾ç¤ºç»¿è‰²ï¼Œå¤±è´¥æ˜¾ç¤ºçº¢è‰²
- **è¿è¡Œç»Ÿè®¡**: æ˜¾ç¤ºè¿è¡Œæ¬¡æ•°ã€æˆåŠŸæ¬¡æ•°ã€æˆåŠŸç‡

#### å¿«é€Ÿåˆ›å»ºåŠŸèƒ½
- **è´¦æˆ·åŒæ­¥**: ä¸ºæ‰€æœ‰æ•°æ®åº“ç±»å‹åˆ›å»ºè´¦æˆ·åŒæ­¥ä»»åŠ¡
- **ç‰ˆæœ¬åŒæ­¥**: ä¸ºæ‰€æœ‰æ•°æ®åº“ç±»å‹åˆ›å»ºç‰ˆæœ¬åŒæ­¥ä»»åŠ¡
- **å¤§å°åŒæ­¥**: ä¸ºæ‰€æœ‰æ•°æ®åº“ç±»å‹åˆ›å»ºå¤§å°åŒæ­¥ä»»åŠ¡
- **å…¨éƒ¨åŒæ­¥**: ä¸€æ¬¡æ€§åˆ›å»ºæ‰€æœ‰ç±»å‹çš„åŒæ­¥ä»»åŠ¡

### å†…ç½®ä»»åŠ¡æ¨¡æ¿

#### PostgreSQLè´¦æˆ·åŒæ­¥
```python
def sync_postgresql_accounts(instance, config):
    """åŒæ­¥PostgreSQLæ•°æ®åº“è´¦æˆ·ä¿¡æ¯"""
    # è¿æ¥æ•°æ®åº“
    # æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
    # æ›´æ–°è´¦æˆ·è®°å½•
    # è¿”å›åŒæ­¥ç»“æœ
```

#### MySQLè´¦æˆ·åŒæ­¥
```python
def sync_mysql_accounts(instance, config):
    """åŒæ­¥MySQLæ•°æ®åº“è´¦æˆ·ä¿¡æ¯"""
    # è¿æ¥æ•°æ®åº“
    # æŸ¥è¯¢ç”¨æˆ·æƒé™
    # æ›´æ–°è´¦æˆ·è®°å½•
    # è¿”å›åŒæ­¥ç»“æœ
```

#### ç‰ˆæœ¬åŒæ­¥ä»»åŠ¡
```python
def sync_postgresql_version(instance, config):
    """åŒæ­¥PostgreSQLæ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯"""
    # æŸ¥è¯¢ç‰ˆæœ¬ä¿¡æ¯
    # æ›´æ–°å®ä¾‹æ ‡ç­¾
    # è¿”å›ç‰ˆæœ¬ä¿¡æ¯
```

#### æ•°æ®åº“å¤§å°åŒæ­¥
```python
def sync_postgresql_size(instance, config):
    """åŒæ­¥PostgreSQLæ•°æ®åº“å¤§å°ä¿¡æ¯"""
    # æŸ¥è¯¢æ•°æ®åº“å¤§å°
    # æ›´æ–°å®ä¾‹æ ‡ç­¾
    # è¿”å›å¤§å°ä¿¡æ¯
```

## å®‰å…¨è®¾è®¡

### è®¤è¯ä¸æˆæƒ

1. **ç”¨æˆ·è®¤è¯**
   - åŸºäºFlask-Loginçš„ä¼šè¯ç®¡ç†
   - å¯†ç ä½¿ç”¨bcryptåŠ å¯†å­˜å‚¨
   - æ”¯æŒJWTä»¤ç‰Œè®¤è¯

2. **æƒé™æ§åˆ¶**
   - åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶(RBAC)
   - è·¯ç”±çº§åˆ«çš„æƒé™éªŒè¯
   - APIæ¥å£è®¤è¯ä¿æŠ¤

3. **æ•°æ®å®‰å…¨**
   - æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
   - SQLæ³¨å…¥é˜²æŠ¤
   - XSSæ”»å‡»é˜²æŠ¤
   - CSRFä¿æŠ¤

### å®‰å…¨é…ç½®

```python
# å¯†ç åŠ å¯†
bcrypt = Bcrypt()

# JWTé…ç½®
JWT_SECRET_KEY = os.getenv('JWT_SECRET_KEY')
JWT_ACCESS_TOKEN_EXPIRES = timedelta(hours=24)

# ä¼šè¯å®‰å…¨
SESSION_COOKIE_SECURE = True
SESSION_COOKIE_HTTPONLY = True
SESSION_COOKIE_SAMESITE = 'Lax'

# CSRFä¿æŠ¤
CSRFProtect(app)

# CORSé…ç½®
CORS(app, origins=['http://localhost:5001'])
```

## æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–

1. **ç´¢å¼•ç­–ç•¥**
   - ä¸»é”®è‡ªåŠ¨ç´¢å¼•
   - å¤–é”®ç´¢å¼•
   - æŸ¥è¯¢å­—æ®µç´¢å¼•
   - å¤åˆç´¢å¼•ä¼˜åŒ–

2. **æŸ¥è¯¢ä¼˜åŒ–**
   - ä½¿ç”¨SQLAlchemyçš„joinæŸ¥è¯¢
   - é¿å…N+1æŸ¥è¯¢é—®é¢˜
   - åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–
   - æŸ¥è¯¢ç»“æœç¼“å­˜

3. **è¿æ¥æ± ç®¡ç†**
   - æ•°æ®åº“è¿æ¥æ± 
   - Redisè¿æ¥æ± 
   - å¤–éƒ¨æ•°æ®åº“è¿æ¥ç®¡ç†

### ç¼“å­˜ç­–ç•¥

1. **Redisç¼“å­˜**
   - ç”¨æˆ·ä¼šè¯ç¼“å­˜
   - æŸ¥è¯¢ç»“æœç¼“å­˜
   - ä»»åŠ¡æ‰§è¡Œç»“æœç¼“å­˜

2. **åº”ç”¨ç¼“å­˜**
   - é™æ€èµ„æºç¼“å­˜
   - æ¨¡æ¿ç¼“å­˜
   - é…ç½®å‚æ•°ç¼“å­˜

### å¼‚æ­¥å¤„ç†

1. **Celeryä»»åŠ¡é˜Ÿåˆ—**
   - é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡
   - å®šæ—¶ä»»åŠ¡è°ƒåº¦
   - æ‰¹é‡æ•°æ®å¤„ç†

2. **å¼‚æ­¥API**
   - éé˜»å¡çš„æ•°æ®åº“æ“ä½œ
   - å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œ
   - å®æ—¶çŠ¶æ€æ›´æ–°

## ç›‘æ§ä¸æ—¥å¿—

### æ—¥å¿—ç³»ç»Ÿ

1. **æ—¥å¿—åˆ†ç±»**
   - åº”ç”¨æ—¥å¿— (app.log)
   - è®¤è¯æ—¥å¿— (auth.log)
   - æ•°æ®åº“æ—¥å¿— (database.log)
   - å®‰å…¨æ—¥å¿— (security.log)
   - åŒæ­¥æ—¥å¿— (sync.log)
   - APIæ—¥å¿— (api.log)
   - ç¼“å­˜æ—¥å¿— (cache.log)

2. **æ—¥å¿—æ ¼å¼**
   - ç»“æ„åŒ–æ—¥å¿—è®°å½•
   - æ—¶é—´æˆ³å’Œæ—¶åŒºå¤„ç†
   - ç”¨æˆ·æ“ä½œè¿½è¸ª
   - é”™è¯¯å †æ ˆè®°å½•

3. **æ—¥å¿—è½®è½¬**
   - æŒ‰å¤§å°è½®è½¬
   - æŒ‰æ—¶é—´è½®è½¬
   - æ—¥å¿—å‹ç¼©å­˜å‚¨
   - å†å²æ—¥å¿—æ¸…ç†

### ç›‘æ§æŒ‡æ ‡

1. **ç³»ç»ŸæŒ‡æ ‡**
   - CPUä½¿ç”¨ç‡
   - å†…å­˜ä½¿ç”¨ç‡
   - ç£ç›˜ä½¿ç”¨ç‡
   - ç½‘ç»œè¿æ¥æ•°

2. **åº”ç”¨æŒ‡æ ‡**
   - è¯·æ±‚å“åº”æ—¶é—´
   - é”™è¯¯ç‡ç»Ÿè®¡
   - ä»»åŠ¡æ‰§è¡ŒæˆåŠŸç‡
   - æ•°æ®åº“è¿æ¥çŠ¶æ€

3. **ä¸šåŠ¡æŒ‡æ ‡**
   - ç”¨æˆ·æ´»è·ƒåº¦
   - å®ä¾‹è¿æ¥æ•°
   - åŒæ­¥ä»»åŠ¡æ‰§è¡Œæ¬¡æ•°
   - æ•°æ®åŒæ­¥é‡

## éƒ¨ç½²æ¶æ„

### å¼€å‘ç¯å¢ƒ

```yaml
# æœ¬åœ°å¼€å‘ç¯å¢ƒ
services:
  app:
    build: .
    ports:
      - "5001:5001"
    environment:
      - FLASK_ENV=development
      - DATABASE_URL=sqlite:///instance.db
    volumes:
      - ./userdata:/app/userdata

  redis:
    image: redis:7.2.5
    ports:
      - "6379:6379"
    volumes:
      - ./userdata/redis:/data
```

### ç”Ÿäº§ç¯å¢ƒ

```yaml
# ç”Ÿäº§ç¯å¢ƒ
services:
  app:
    build: .
    ports:
      - "5001:5001"
    environment:
      - FLASK_ENV=production
      - DATABASE_URL=postgresql://user:pass@postgres:5432/taifish
    depends_on:
      - postgres
      - redis

  postgres:
    image: postgres:16.3
    environment:
      - POSTGRES_DB=taifish
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=pass
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7.2.5
    volumes:
      - redis_data:/data

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - app
```

## å¼€å‘è§„èŒƒ

### ä»£ç ç»“æ„

```
app/
â”œâ”€â”€ __init__.py          # åº”ç”¨åˆå§‹åŒ–
â”œâ”€â”€ config.py            # é…ç½®æ–‡ä»¶
â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ user.py
â”‚   â”œâ”€â”€ instance.py
â”‚   â”œâ”€â”€ credential.py
â”‚   â”œâ”€â”€ account.py
â”‚   â”œâ”€â”€ task.py
â”‚   â”œâ”€â”€ log.py
â”‚   â”œâ”€â”€ global_param.py
â”‚   â””â”€â”€ sync_data.py
â”œâ”€â”€ routes/              # è·¯ç”±æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ auth.py
â”‚   â”œâ”€â”€ instances.py
â”‚   â”œâ”€â”€ credentials.py
â”‚   â”œâ”€â”€ accounts.py
â”‚   â”œâ”€â”€ tasks.py
â”‚   â”œâ”€â”€ dashboard.py
â”‚   â”œâ”€â”€ logs.py
â”‚   â”œâ”€â”€ params.py
â”‚   â”œâ”€â”€ api.py
â”‚   â””â”€â”€ main.py
â”œâ”€â”€ services/            # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”œâ”€â”€ database_service.py
â”‚   â”œâ”€â”€ database_drivers.py
â”‚   â””â”€â”€ task_executor.py
â”œâ”€â”€ utils/               # å·¥å…·ç±»
â”‚   â”œâ”€â”€ logger.py
â”‚   â”œâ”€â”€ security.py
â”‚   â”œâ”€â”€ timezone.py
â”‚   â”œâ”€â”€ cache_manager.py
â”‚   â”œâ”€â”€ rate_limiter.py
â”‚   â”œâ”€â”€ error_handler.py
â”‚   â””â”€â”€ env_manager.py
â””â”€â”€ templates/           # æ¨¡æ¿æ–‡ä»¶
    â”œâ”€â”€ base.html
    â”œâ”€â”€ auth/
    â”œâ”€â”€ instances/
    â”œâ”€â”€ credentials/
    â”œâ”€â”€ accounts/
    â”œâ”€â”€ tasks/
    â”œâ”€â”€ dashboard/
    â”œâ”€â”€ logs/
    â”œâ”€â”€ params/
    â””â”€â”€ errors/
```

### å‘½åè§„èŒƒ

1. **æ–‡ä»¶å‘½å**
   - ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿
   - æ¨¡å‹æ–‡ä»¶ä½¿ç”¨å•æ•°å½¢å¼
   - è·¯ç”±æ–‡ä»¶ä½¿ç”¨å¤æ•°å½¢å¼

2. **ç±»å‘½å**
   - ä½¿ç”¨å¤§é©¼å³°å‘½åæ³•
   - æ¨¡å‹ç±»ä½¿ç”¨å•æ•°å½¢å¼
   - æœåŠ¡ç±»ä»¥Serviceç»“å°¾

3. **å‡½æ•°å‘½å**
   - ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿
   - åŠ¨è¯å¼€å¤´ï¼Œæè¿°åŠŸèƒ½
   - ç§æœ‰æ–¹æ³•ä»¥ä¸‹åˆ’çº¿å¼€å¤´

4. **å˜é‡å‘½å**
   - ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿
   - å¸¸é‡ä½¿ç”¨å¤§å†™å­—æ¯å’Œä¸‹åˆ’çº¿
   - å¸ƒå°”å˜é‡ä½¿ç”¨is_ã€has_ã€can_å‰ç¼€

### ä»£ç è´¨é‡

1. **ä»£ç æ³¨é‡Š**
   - ä½¿ç”¨JSDocé£æ ¼çš„å‡½æ•°æ³¨é‡Š
   - å¤æ‚é€»è¾‘æ·»åŠ è¡Œå†…æ³¨é‡Š
   - ç±»å’Œæ¨¡å—æ·»åŠ æ–‡æ¡£å­—ç¬¦ä¸²

2. **é”™è¯¯å¤„ç†**
   - ä½¿ç”¨try-catchå¤„ç†å¼‚å¸¸
   - è®°å½•è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
   - è¿”å›ç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯

3. **æµ‹è¯•è¦†ç›–**
   - å•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒåŠŸèƒ½
   - é›†æˆæµ‹è¯•è¦†ç›–APIæ¥å£
   - ç«¯åˆ°ç«¯æµ‹è¯•è¦†ç›–ç”¨æˆ·æµç¨‹

## ç‰ˆæœ¬å†å²

### v1.0.0 (2025-09-08)
- âœ… åŸºç¡€ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- âœ… å¤šæ•°æ®åº“å®ä¾‹ç®¡ç†
- âœ… å‡­æ®ç®¡ç†ç³»ç»Ÿ
- âœ… è´¦æˆ·ä¿¡æ¯ç®¡ç†
- âœ… ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ
- âœ… æ“ä½œæ—¥å¿—è®°å½•
- âœ… å®æ—¶ç›‘æ§ä»ªè¡¨æ¿
- âœ… RESTful APIæ¥å£
- âœ… å®‰å…¨é˜²æŠ¤æœºåˆ¶
- âœ… æ€§èƒ½ä¼˜åŒ–
- âœ… å®Œæ•´çš„æ–‡æ¡£


---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**æœ€åæ›´æ–°**: 2025-09-08
**ç»´æŠ¤è€…**: æ³°æ‘¸é±¼å§å¼€å‘å›¢é˜Ÿ
